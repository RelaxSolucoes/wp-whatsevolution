# WP WhatsEvolution v1.4.1

ğŸš€ **A RevoluÃ§Ã£o do Envio em Massa + Sistema Completo de AutomaÃ§Ã£o WhatsApp**

## ğŸ†• **NOVO na v1.4.1: CorreÃ§Ãµes CrÃ­ticas e Melhorias Significativas**

### ğŸ› **CorreÃ§Ãµes CrÃ­ticas Implementadas**
- **âœ… Submenus Funcionando**: Corrigido problema de submenus ausentes que afetava toda a navegaÃ§Ã£o
- **âœ… VariÃ¡veis DinÃ¢micas**: Sistema robusto de exibiÃ§Ã£o por aba no envio em massa
- **âœ… Fallback Inteligente**: EndereÃ§os de envio sempre funcionam, mesmo com configuraÃ§Ãµes WooCommerce complexas

### ğŸš€ **Melhorias de Interface e Performance**
- **ğŸ¨ Interface Intuitiva**: VariÃ¡veis WooCommerce sempre visÃ­veis por padrÃ£o
- **âš¡ Sistema Robusto**: Fallbacks mÃºltiplos para sessionStorage e compatibilidade
- **ğŸ”§ CÃ³digo Otimizado**: ReorganizaÃ§Ã£o completa seguindo boas prÃ¡ticas WordPress
- **ğŸ“± Responsividade**: Interface moderna e adaptÃ¡vel a todos os dispositivos

### ğŸ—ï¸ **Arquitetura WordPress Corrigida**
- **â° Timing dos Hooks**: Propriedades de menu definidas ANTES dos hooks WordPress
- **ğŸ”— Compatibilidade HPOS**: Suporte completo ao novo sistema de pedidos WooCommerce
- **ğŸ“š Boas PrÃ¡ticas**: CÃ³digo seguindo padrÃµes WordPress e PHP modernos

---

## ğŸ†• **NOVO na v1.4.0: IntegraÃ§Ã£o com Agentes de IA do n8n**

### ğŸ¤– IntegraÃ§Ã£o n8n (AI Agents)
- Conecte fluxos do n8n para gerar e refinar mensagens com IA
- Use dados do WooCommerce (pedidos, clientes, carrinho) como contexto
- Ideal para suporte, upsell, recuperaÃ§Ã£o e fluxos conversacionais

---

## ğŸ†• **NOVO na v1.3.2: PadronizaÃ§Ã£o e Estabilidade**

### ğŸ”§ PadronizaÃ§Ãµes e Melhorias
- **I18n**: Text domain padronizado para `wp-whatsevolution`
- **Arquivo Principal**: Renomeado para `wp-whatsevolution.php`
- **Checkout**: ValidaÃ§Ã£o apenas de telefone (CPF/CNPJ ignorados)
- **Compatibilidade**: Cart Abandonment Recovery silenciosa (sem aviso na UI)
- **Templates**: Fallback automÃ¡tico quando ausentes (Quick Signup)
- **TraduÃ§Ãµes**: GeraÃ§Ã£o automÃ¡tica de `.mo` quando faltar

---

## ğŸ†• **Destaques da v1.3.0: Envio em Massa Reescrito do Zero!**

### âœ¨ **RevoluÃ§Ã£o do Envio em Massa**
- **ğŸ“Š Interface Intuitiva** - Abas organizadas (WooCommerce, CSV, Manual)
- **ğŸ” DetecÃ§Ã£o Inteligente** - CSV com separadores automÃ¡ticos (vÃ­rgula/ponto e vÃ­rgula)
- **ğŸ“± VariÃ¡veis Contextuais** - Diferentes variÃ¡veis por fonte de dados
- **âš¡ Performance Otimizada** - Sistema robusto e Ã  prova de falhas
- **ğŸ¯ HistÃ³rico Completo** - Logs detalhados com limpeza automÃ¡tica

### ğŸ”§ **Sistema de Fallback Inteligente**
- **ğŸ“ EndereÃ§os de Envio** - Detecta automaticamente quando endereÃ§o estÃ¡ vazio e usa dados de cobranÃ§a
- **ğŸ“± ValidaÃ§Ã£o Ultra-Robusta** - Aceita 8, 9, 10, 11, 12, 13 dÃ­gitos brasileiros
- **ğŸ”„ Compatibilidade Total** - Funciona com qualquer configuraÃ§Ã£o do WooCommerce

---

## ğŸ“‹ **DescriÃ§Ã£o**

O **WP WhatsEvolution** Ã© o plugin mais avanÃ§ado para integraÃ§Ã£o de mensagens + WooCommerce, oferecendo:

- ğŸš€ **Quick Signup** com teste grÃ¡tis de 7 dias
- ğŸ›’ **Carrinho Abandonado** com interceptaÃ§Ã£o interna revolucionÃ¡ria
- ğŸ“Š **Envio por Status** de pedido automatizado  
- ğŸ“± **Envio Individual** para clientes especÃ­ficos
- ğŸ“¢ **Envio em Massa** com filtros avanÃ§ados (REESCRITO v1.3.0)
- âœ… **ValidaÃ§Ã£o no Checkout** em tempo real
- ğŸ¨ **Templates PersonalizÃ¡veis** com shortcodes dinÃ¢micos
- ğŸ§  **Sistema Inteligente** de fallback e validaÃ§Ã£o

---

## ğŸ”§ **Dois Modos de OperaÃ§Ã£o**

### ğŸš€ **Modo Managed (Free Trial)**
- **Backend Supabase**: Usado apenas para onboarding e verificaÃ§Ã£o de status
- **ConfiguraÃ§Ã£o**: AutomÃ¡tica em 30 segundos
- **Custo**: 7 dias grÃ¡tis, depois pago
- **Ideal para**: Quem quer testar sem complicaÃ§Ãµes tÃ©cnicas

### âš™ï¸ **Modo Manual (Credenciais PrÃ³prias)**
- **Backend**: 100% local, sem calls externos
- **ConfiguraÃ§Ã£o**: URL, API Key, InstÃ¢ncia prÃ³prias
- **Custo**: Zero (usa sua Evolution API)
- **Ideal para**: Quem jÃ¡ tem Evolution API configurada

## ğŸ” **Compatibilidade de VersÃµes da Evolution API**

### âœ… **VersÃµes Suportadas**
- **Evolution API V2.x.x**: âœ… **Totalmente compatÃ­vel** - Todas as funcionalidades funcionam perfeitamente
- **Evolution API V1.x.x**: âš ï¸ **Compatibilidade limitada** - Sistema funciona mas com avisos de incompatibilidade

### ğŸš¨ **Avisos AutomÃ¡ticos**
- **DetecÃ§Ã£o Inteligente**: Sistema verifica automaticamente a versÃ£o da sua API
- **Avisos Visuais**: Interface mostra claramente quando hÃ¡ incompatibilidade
- **RecomendaÃ§Ãµes**: OrientaÃ§Ãµes para atualizaÃ§Ã£o quando necessÃ¡rio

### ğŸ“± **Como Funciona**
1. **ConfiguraÃ§Ã£o**: Insira URL, API Key e Nome da InstÃ¢ncia
2. **VerificaÃ§Ã£o**: Sistema testa conexÃ£o e verifica versÃ£o automaticamente
3. **Feedback**: Interface mostra status e avisos de compatibilidade
4. **AÃ§Ã£o**: Atualize para V2 se necessÃ¡rio ou continue usando V1 com limitaÃ§Ãµes

---

## ğŸš€ **Quick Signup - Comece em 30 Segundos**

### ğŸ¯ **Para quem nÃ£o tem Evolution API**

1. **Acesse** "WhatsEvolution > ğŸš€ Teste GrÃ¡tis"
2. **Preencha** seus dados (nome, email, WhatsApp)
3. **Clique** em "Criar Conta e Testar Agora"
4. **Aguarde** a configuraÃ§Ã£o automÃ¡tica (30 segundos)
5. **Conecte** seu WhatsApp via QR Code
6. **Pronto!** Teste todas as funcionalidades por 7 dias

### âœ¨ **Vantagens do Quick Signup**
- ğŸ†“ **7 dias grÃ¡tis** sem cartÃ£o de crÃ©dito
- âš¡ **ConfiguraÃ§Ã£o automÃ¡tica** de toda a Evolution API  
- ğŸ› ï¸ **Sem complicaÃ§Ãµes tÃ©cnicas** (VPS, Docker, etc.)
- ğŸ“ **Suporte tÃ©cnico incluÃ­do** no perÃ­odo de teste
- ğŸ”„ **FÃ¡cil upgrade** quando decidir continuar

---

## ğŸ›’ **Carrinho Abandonado - Funcionalidades Detalhadas**

### ğŸ”§ **ConfiguraÃ§Ã£o da IntegraÃ§Ã£o**

A configuraÃ§Ã£o Ã© feita em duas partes: ativar em nosso plugin e configurar o plugin parceiro.

#### **Passo 1: Instale o Plugin Parceiro**
1.  **Instale e ative** o plugin "WooCommerce Cart Abandonment Recovery".

#### **Passo 2: Configure a IntegraÃ§Ã£o**
Siga as instruÃ§Ãµes que aparecem na nossa pÃ¡gina de configuraÃ§Ãµes:

1.  Navegue atÃ©: **WooCommerce â†’ Cart Abandonment â†’ Settings â†’ Webhook Settings**.
2.  **Ative** a opÃ§Ã£o `"Enable Webhook"`.
3.  **Cole a URL** fornecida pelo nosso plugin no campo `"Webhook URL"`.
4.  **Teste** a integraÃ§Ã£o clicando em `"Trigger Sample"`.
5.  **Salve as configuraÃ§Ãµes**.

### ğŸ¯ **InterceptaÃ§Ã£o Interna RevolucionÃ¡ria**
- **âš¡ IntegraÃ§Ã£o Simplificada** - Apenas ative o webhook no plugin parceiro.
- **ğŸ”’ 100% Seguro** - Dados nunca saem do servidor WordPress para o webhook.
- **âš¡ Zero LatÃªncia** - Processamento instantÃ¢neo via hooks internos.
- **ğŸ¯ InterceptaÃ§Ã£o Inteligente** - Captura carrinhos ANTES do webhook externo ser enviado.

### ğŸ¨ **Shortcodes DisponÃ­veis**

| Shortcode | DescriÃ§Ã£o | Exemplo |
|-----------|-----------|---------|
| `{first_name}` | Nome do cliente | JoÃ£o |
| `{full_name}` | Nome completo | JoÃ£o Silva |
| `{email}` | Email do cliente | joao@email.com |
| `{product_names}` | Produtos no carrinho | Produto A, Produto B |
| `{cart_total}` | Valor formatado | R$ 149,90 |
| `{cart_total_raw}` | Valor sem formataÃ§Ã£o | 149.90 |
| `{checkout_url}` | Link finalizar compra | https://loja.com/checkout?token=abc |
| `{coupon_code}` | CÃ³digo do cupom | DESCONTO10 |
| `{site_name}` | Nome da loja | Minha Loja |
| `{site_url}` | URL da loja | https://loja.com |

### ğŸ“± **Template PadrÃ£o Brasileiro**

```
ğŸ›’ Oi {first_name}!

Vi que vocÃª adicionou estes itens no carrinho:
ğŸ“¦ {product_names}

ğŸ’° Total: {cart_total}

ğŸ Use o cupom *{coupon_code}* e ganhe desconto especial!
â° Mas corre que Ã© sÃ³ por hoje!

Finalize agora:
ğŸ‘† {checkout_url}
```

---

## ğŸ“¢ **Envio em Massa - RevoluÃ§Ã£o v1.3.0**

### ğŸ†• **Nova Interface Intuitiva**

#### **ğŸ›’ Aba WooCommerce**
- **Filtros AvanÃ§ados**: Status de pedido, perÃ­odo, valor mÃ­nimo
- **VariÃ¡veis DinÃ¢micas**: Dados completos do cliente e pedidos
- **Preview Inteligente**: Visualize clientes antes do envio

#### **ğŸ“„ Aba ImportaÃ§Ã£o CSV**
- **DetecÃ§Ã£o AutomÃ¡tica**: Separadores vÃ­rgula (,) ou ponto e vÃ­rgula (;)
- **CodificaÃ§Ã£o UTF-8**: Suporte completo a acentos brasileiros
- **Template de Exemplo**: Download de arquivo modelo
- **VariÃ¡veis**: `{customer_name}`, `{customer_phone}`

#### **âœï¸ Aba Lista Manual**
- **Interface Simples**: Um nÃºmero por linha
- **ValidaÃ§Ã£o AutomÃ¡tica**: Formato brasileiro
- **Sem VariÃ¡veis**: Mensagem fixa para todos

### âš¡ **Controle de Envio**
- **Velocidade ConfigurÃ¡vel**: Segundos entre cada envio
- **Agendamento**: Data e hora para iniciar
- **Progresso em Tempo Real**: Barra de progresso com status
- **HistÃ³rico Completo**: Logs detalhados com limpeza

---

## ğŸ“Š **Envio por Status - AutomaÃ§Ã£o Inteligente**

### ğŸ¯ **Status Suportados**
- **pending/on-hold**: Pedido recebido, aguardando pagamento
- **processing**: Pedido aprovado, preparando envio
- **completed**: Pedido concluÃ­do com sucesso
- **cancelled**: Pedido cancelado
- **refunded**: Reembolso processado
- **failed**: Problema no pedido

### ğŸ§  **Sistema de Fallback Inteligente**
- **DetecÃ§Ã£o AutomÃ¡tica**: Quando endereÃ§o de entrega estÃ¡ vazio
- **Fallback Inteligente**: Usa dados de cobranÃ§a automaticamente
- **Compatibilidade Total**: Funciona com qualquer configuraÃ§Ã£o do WooCommerce

### ğŸ“± **Templates por Status**
Cada status tem template personalizÃ¡vel com variÃ¡veis especÃ­ficas do pedido.

---

## ğŸ·ï¸ **VariÃ¡veis DisponÃ­veis (Expandidas)**

### ğŸ›’ **Dados do Pedido**
| VariÃ¡vel | DescriÃ§Ã£o | Exemplo |
|----------|-----------|---------|
| `{order_id}` | ID do pedido | #1234 |
| `{order_total}` | Valor total | R$ 149,90 |
| `{order_url}` | Link do pedido | https://loja.com/pedido/1234 |
| `{payment_method}` | MÃ©todo de pagamento | CartÃ£o de CrÃ©dito |
| `{shipping_method}` | MÃ©todo de envio | Correios |

### ğŸ‘¤ **Dados do Cliente**
| VariÃ¡vel | DescriÃ§Ã£o | Exemplo |
|----------|-----------|---------|
| `{customer_name}` | Nome completo | JoÃ£o Silva |
| `{customer_email}` | Email | joao@email.com |
| `{customer_phone}` | Telefone | +55 11 99999-9999 |
| `{total_orders}` | Total de pedidos | 5 |
| `{last_order_date}` | Ãšltimo pedido | 15/01/2025 |

### ğŸ“ **EndereÃ§os (Com Fallback)**
| VariÃ¡vel | DescriÃ§Ã£o | Exemplo |
|----------|-----------|---------|
| `{shipping_address_full}` | EndereÃ§o completo de entrega | Rua A, 123 - SÃ£o Paulo, SP |
| `{billing_address_full}` | EndereÃ§o de cobranÃ§a | Rua B, 456 - Rio de Janeiro, RJ |

### ğŸª **Dados da Loja**
| VariÃ¡vel | DescriÃ§Ã£o | Exemplo |
|----------|-----------|---------|
| `{store_name}` | Nome da loja | Minha Loja |
| `{store_url}` | URL da loja | https://loja.com |
| `{store_email}` | Email da loja | contato@loja.com |

---

## âœ… **ValidaÃ§Ã£o no Checkout - Ultra-Robusta**

### ğŸ“± **ValidaÃ§Ã£o Brasileira AvanÃ§ada**
- **MÃºltiplos Formatos**: Aceita 8, 9, 10, 11, 12, 13 dÃ­gitos
- **DDDs VÃ¡lidos**: ValidaÃ§Ã£o de cÃ³digos 11-99
- **Formato Antigo**: Detecta e corrige celulares sem o 9
- **Zero Erros**: Nunca mais "Formato de telefone invÃ¡lido"

### âš¡ **Funcionalidades**
- **Tempo Real**: ValidaÃ§Ã£o enquanto digita
- **Modal Inteligente**: ConfirmaÃ§Ã£o quando nÃºmero invÃ¡lido
- **Compatibilidade**: NÃ£o interfere com mÃ¡scaras existentes
- **CustomizaÃ§Ã£o**: TÃ­tulos e mensagens personalizÃ¡veis

---

## ğŸ§  **Sistema Inteligente de Fallback**

### ğŸ“ **EndereÃ§os de Envio**
- **DetecÃ§Ã£o AutomÃ¡tica**: Quando endereÃ§o de entrega estÃ¡ vazio
- **Fallback Inteligente**: Usa dados de cobranÃ§a automaticamente
- **Compatibilidade**: Funciona com qualquer configuraÃ§Ã£o do WooCommerce
- **Zero ConfiguraÃ§Ã£o**: Funciona automaticamente

### ğŸ“± **ValidaÃ§Ã£o Ultra-Robusta**
- **NÃºmeros Brasileiros**: Aceita 8, 9, 10, 11, 12, 13 dÃ­gitos
- **DDDs VÃ¡lidos**: ValidaÃ§Ã£o de cÃ³digos 11-99
- **Formato Antigo**: Detecta e corrige celulares sem o 9
- **Zero Erros**: Nunca mais "Formato de telefone invÃ¡lido"

---

## ğŸ“Š **Sistema Completo de Logs**

### ğŸ” **NÃ­veis de Log**
- **Error**: Erros crÃ­ticos do sistema
- **Warning**: Avisos importantes  
- **Info**: InformaÃ§Ãµes gerais
- **Debug**: Apenas em modo debug

### ğŸ’¾ **Armazenamento**
- **Banco de Dados**: Tabela `wpwevo_logs`
- **WooCommerce**: IntegraÃ§Ã£o com sistema de logs do WC
- **Limpeza**: AutomÃ¡tica para manter performance

### ğŸ“‹ **HistÃ³rico de Envios**
- **Envio em Massa**: Logs completos com sucesso/erro
- **Carrinho Abandonado**: Logs em tempo real
- **Limpeza**: FunÃ§Ã£o para limpar histÃ³rico antigo

---

## ğŸ”§ **Requisitos**

- **PHP:** 7.4 ou superior
- **WordPress:** 5.8 ou superior  
- **WooCommerce:** 5.0 ou superior
- **Evolution API:** InstÃ¢ncia configurada (ou use o Quick Signup!)

---

## ğŸš€ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### ğŸ¯ **OpÃ§Ã£o 1: Download do GitHub (Recomendado)**

```bash
1. Baixe o ZIP direto do GitHub
2. Envie para /wp-content/plugins/ (pode ficar como "wp-whatsevolution-main")  
3. Ative no painel WordPress
4. Use "ğŸš€ Teste GrÃ¡tis" para configuraÃ§Ã£o automÃ¡tica
```

### ğŸ¯ **OpÃ§Ã£o 2: ConfiguraÃ§Ã£o Manual**

```bash
1. URL da API: https://sua-api.com
2. API Key: sua-chave-aqui
3. InstÃ¢ncia: nome-da-instancia
4. Testar ConexÃ£o âœ…
```

### 3ï¸âƒ£ **AtivaÃ§Ã£o Carrinho Abandonado**

```bash
1. Instalar "WooCommerce Cart Abandonment Recovery"
2. Ir em "WhatsEvolution > Carrinho Abandonado" 
3. Ativar integraÃ§Ã£o âœ…
4. Personalizar template (opcional)
```

---

## ğŸ”§ **Hooks para Desenvolvedores**

### ğŸ¨ **Personalizar Mensagem Carrinho Abandonado**

```php
add_filter('wpwevo_cart_abandonment_message', function($message, $data) {
    $trigger_details = $data['trigger_details'];
    
    // Adicionar desconto para carrinhos de alto valor
    if (floatval($trigger_details['cart_total']) > 200) {
        $message .= "\n\nğŸ USE VOLTA10 e ganhe 10% OFF!";
    }
    
    return $message;
}, 10, 2);
```

### ğŸ“Š **Hook ApÃ³s Envio Bem-Sucedido**

```php
add_action('wpwevo_cart_abandonment_sent', function($phone, $message, $trigger_details) {
    // Log personalizado
    error_log("WhatsApp enviado para: {$phone}");
    
    // IntegraÃ§Ã£o com outros sistemas
    // ...
}, 10, 3);
```

### ğŸ¯ **Personalizar ValidaÃ§Ã£o de Telefone**

```php
add_filter('wpwevo_validate_phone', function($phone, $original) {
    // LÃ³gica personalizada de validaÃ§Ã£o
    if (strlen($phone) < 10) {
        return false;
    }
    
    return $phone;
}, 10, 2);
```

---

## ğŸ“Š **Todas as Funcionalidades**

### ğŸš€ **Quick Signup (Onboarding 1-Click)**
- âœ… Teste grÃ¡tis por 7 dias
- âœ… ConfiguraÃ§Ã£o automÃ¡tica em 30s
- âœ… Sem VPS/Docker necessÃ¡rio
- âœ… Suporte tÃ©cnico incluÃ­do
- âœ… Upgrade simplificado

### ğŸ›’ **Carrinho Abandonado**
- âœ… InterceptaÃ§Ã£o interna automÃ¡tica
- âœ… Templates personalizÃ¡veis  
- âœ… Shortcodes dinÃ¢micos
- âœ… Logs em tempo real
- âœ… FormataÃ§Ã£o brasileira (R$)

### ğŸ“Š **Envio por Status**
- âœ… AutomaÃ§Ã£o por status de pedido
- âœ… Templates por status
- âœ… VariÃ¡veis dinÃ¢micas
- âœ… Sistema de fallback inteligente
- âœ… ConfiguraÃ§Ã£o flexÃ­vel

### ğŸ“± **Envio Individual**
- âœ… Interface simples
- âœ… ValidaÃ§Ã£o automÃ¡tica
- âœ… HistÃ³rico de envios
- âœ… VariÃ¡veis da loja

### ğŸ“¢ **Envio em Massa (v1.3.0)**
- âœ… Interface reescrita do zero
- âœ… Filtros avanÃ§ados
- âœ… ImportaÃ§Ã£o CSV inteligente
- âœ… Controle de velocidade
- âœ… HistÃ³rico completo
- âœ… VariÃ¡veis contextuais

### âœ… **ValidaÃ§Ã£o Checkout**
- âœ… Campo obrigatÃ³rio
- âœ… ValidaÃ§Ã£o tempo real
- âœ… FormataÃ§Ã£o automÃ¡tica
- âœ… Modal de confirmaÃ§Ã£o
- âœ… ValidaÃ§Ã£o ultra-robusta

### ğŸ§  **Sistema Inteligente**
- âœ… Fallback automÃ¡tico de endereÃ§os
- âœ… ValidaÃ§Ã£o brasileira avanÃ§ada
- âœ… Logs completos
- âœ… Compatibilidade total

---

## ğŸ”’ **SeguranÃ§a e Privacidade**

### ğŸ›¡ï¸ **ProteÃ§Ãµes Implementadas**
- **Nonces**: Todos os AJAX protegidos
- **Capabilities**: `manage_options` para admin
- **SanitizaÃ§Ã£o**: Input sanitization em todos os campos
- **ValidaÃ§Ã£o**: NÃºmeros de telefone e dados crÃ­ticos

### ğŸ”’ **Dados SensÃ­veis**
- **Modo Managed**: Dados processados pelo backend Supabase
- **Modo Manual**: 100% local, sem calls externos
- **Logs**: Sem dados sensÃ­veis nos logs
- **Limpeza**: DesinstalaÃ§Ã£o completa via `uninstall.php`

---

## ğŸ“ **Suporte**

### ğŸ†˜ **Canais de Ajuda**
- **DocumentaÃ§Ã£o**: Este README
- **Issues**: GitHub Issues
- **Quick Signup**: Suporte incluÃ­do no perÃ­odo de teste

### ğŸ› **Reportar Bugs**
1. Verifique se Ã© um bug real
2. Teste em ambiente limpo
3. Inclua logs de erro
4. Descreva passos para reproduzir

---

## ğŸ“„ **LicenÃ§a**

Este projeto estÃ¡ sob a licenÃ§a GPL v2 ou posterior.

---

## ğŸ¤ **ContribuiÃ§Ã£o**

ContribuiÃ§Ãµes sÃ£o bem-vindas! Por favor:

1. Fork o projeto
2. Crie uma branch para sua feature
3. Commit suas mudanÃ§as
4. Push para a branch
5. Abra um Pull Request

---

**ğŸ‰ Obrigado por usar o WP WhatsEvolution!** 